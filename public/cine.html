<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cine - Excentrica</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <!-- Sidebar de NavegaciÃ³n Lateral Fijo -->
    <nav class="sidebar-nav">
        <a href="/" class="sidebar-nav-item">
            <span class="icon">ğŸ </span>
            <span>Inicio</span>
        </a>

        <div class="sidebar-divider"></div>

        <div class="sidebar-section-title">Explorar</div>

        <a href="/noticias.html" class="sidebar-nav-item">
            <span class="icon">ğŸ“°</span>
            <span>Noticias</span>
        </a>
        <a href="/mercaderia.html" class="sidebar-nav-item">
            <span class="icon">ğŸ›’</span>
            <span>MercaderÃ­a</span>
        </a>
        <a href="/eventos.html" class="sidebar-nav-item">
            <span class="icon">ğŸ“…</span>
            <span>Eventos</span>
        </a>
        <a href="/videos.html" class="sidebar-nav-item">
            <span class="icon">ğŸ¥</span>
            <span>Videos</span>
        </a>

        <div class="sidebar-divider"></div>

        <div class="sidebar-section-title">Servicios</div>

        <a href="/gastronomia.html" class="sidebar-nav-item">
            <span class="icon">ğŸ½ï¸</span>
            <span>GastronomÃ­a</span>
        </a>
        <a href="/alojamiento.html" class="sidebar-nav-item">
            <span class="icon">ğŸ¨</span>
            <span>Alojamiento</span>
        </a>
        <a href="/transporte.html" class="sidebar-nav-item">
            <span class="icon">ğŸšŒ</span>
            <span>Transporte</span>
        </a>
        <a href="/servicios.html" class="sidebar-nav-item">
            <span class="icon">ğŸ”§</span>
            <span>Servicios</span>
        </a>
        <a href="/puntos-interes.html" class="sidebar-nav-item">
            <span class="icon">ğŸ“</span>
            <span>Turismo</span>
        </a>

        <div class="sidebar-divider"></div>

        <a href="/cine.html" class="sidebar-nav-item active">
            <span class="icon">ğŸ¬</span>
            <span>Cine</span>
        </a>
        <a href="/contacto.html" class="sidebar-nav-item">
            <span class="icon">ğŸ“</span>
            <span>Contacto</span>
        </a>

        <div class="sidebar-divider"></div>

        <a href="/perfil.html" class="sidebar-nav-item">
            <span class="icon">ğŸ‘¤</span>
            <span>Mi Perfil</span>
        </a>
        <a href="/mensajes.html" class="sidebar-nav-item">
            <span class="icon">ğŸ’¬</span>
            <span>Mensajes</span>
        </a>
        <a href="/configuracion.html" class="sidebar-nav-item">
            <span class="icon">âš™ï¸</span>
            <span>ConfiguraciÃ³n</span>
        </a>
    </nav>

    <header class="header">
        <div class="header-inner">
            <a href="/" class="logo"><span>âš¡</span> Excentrica</a>
            <div class="header-search">
                <input type="search" placeholder="Buscar en Excentrica..." />
            </div>
            <div class="user-menu"></div>
            <button class="menu-toggle"><span></span><span></span><span></span></button>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="page-header">
                <h1 class="page-title">ğŸ¬ Cine</h1>
                <p class="page-subtitle">Cines y carteleras en Santiago del Estero</p>
            </div>

            <!-- Filtros -->
            <div class="d-flex gap-3 mb-4 flex-wrap">
                <select id="cinema-filter" class="form-control" style="max-width:250px;">
                    <option value="">Todos los cines</option>
                </select>
                <select id="zone-filter" class="form-control" style="max-width:150px;">
                    <option value="">Todas las zonas</option>
                </select>
            </div>

            <!-- Lista de cines con sus pelÃ­culas -->
            <div id="cinemas-list">
                <div class="text-center p-5"><div class="spinner spinner-lg mx-auto"></div></div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2026 Excentrica. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/components.js"></script>
    <script src="/js/app.js"></script>
    <script>
        async function loadCinemas() {
            const cinemaFilter = document.getElementById('cinema-filter').value;
            const zoneFilter = document.getElementById('zone-filter').value;

            Components.showLoading('#cinemas-list');

            try {
                const response = await api.getCinemas({ cinema: cinemaFilter, zone: zoneFilter });
                const container = document.getElementById('cinemas-list');

                if (response.success && response.data.cinemas.length > 0) {
                    container.innerHTML = response.data.cinemas.map(cinema => {
                        const moviesHtml = cinema.movies && cinema.movies.length > 0
                            ? `<div class="grid grid-4 mt-3">
                                ${cinema.movies.map(movie => Components.movieCard(movie)).join('')}
                               </div>`
                            : '<p class="text-muted mt-3">No hay pelÃ­culas en cartelera</p>';

                        return `
                            <div class="card mb-4">
                                <div class="card-body">
                                    <div class="d-flex justify-between align-center mb-3">
                                        <div>
                                            <h2 class="card-title mb-1">${cinema.name}</h2>
                                            <p class="text-muted mb-0">
                                                <span>ğŸ“ ${cinema.address || 'DirecciÃ³n no disponible'}</span>
                                                ${cinema.zone ? `<span class="ml-3">ğŸ—ºï¸ ${cinema.zone}</span>` : ''}
                                            </p>
                                        </div>
                                        ${cinema.phone ? `<a href="tel:${cinema.phone}" class="btn btn-outline">ğŸ“ Llamar</a>` : ''}
                                    </div>
                                    ${cinema.description ? `<p class="mb-3">${cinema.description}</p>` : ''}
                                    <h3 class="h5 mb-2">ğŸ¥ PelÃ­culas en cartelera</h3>
                                    ${moviesHtml}
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    Components.showEmpty(container, 'No hay cines disponibles', 'ğŸ¬');
                }
            } catch (e) {
                Components.showError('#cinemas-list', 'Error cargando cines');
            }

            Utils.updateUrl({ cinema: cinemaFilter || null, zone: zoneFilter || null });
        }

        async function loadCinemaOptions() {
            try {
                const response = await api.getCinemas({});
                const select = document.getElementById('cinema-filter');

                if (response.success && response.data.cinemas.length > 0) {
                    response.data.cinemas.forEach(cinema => {
                        const option = document.createElement('option');
                        option.value = cinema.id;
                        option.textContent = cinema.name;
                        select.appendChild(option);
                    });
                }
            } catch (e) {
                console.error('Error loading cinema options:', e);
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await Promise.all([
                loadCinemaOptions(),
                App.loadZones('zone-filter')
            ]);

            const params = Utils.getUrlParams();
            if (params.cinema) document.getElementById('cinema-filter').value = params.cinema;
            if (params.zone) document.getElementById('zone-filter').value = params.zone;

            loadCinemas();

            document.getElementById('cinema-filter').addEventListener('change', loadCinemas);
            document.getElementById('zone-filter').addEventListener('change', loadCinemas);
        });
    </script>
</body>
</html>
