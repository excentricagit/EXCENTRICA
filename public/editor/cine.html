<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cine - Editor Excentrica</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/editor/editor.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <a href="/"><span>‚ö°</span> Excentrica</a>
                <span class="admin-badge">EDITOR</span>
            </div>
            <nav class="admin-nav">
                <a href="/editor/" class="admin-nav-item">
                    <span class="icon">üìä</span> Dashboard
                </a>
                <a href="/editor/noticias.html" class="admin-nav-item">
                    <span class="icon">üì∞</span> Noticias
                </a>
                <a href="/editor/productos.html" class="admin-nav-item">
                    <span class="icon">üõí</span> Productos
                </a>
                <a href="/editor/eventos.html" class="admin-nav-item">
                    <span class="icon">üìÖ</span> Eventos
                </a>
                <a href="/editor/categorias.html" class="admin-nav-item">
                    <span class="icon">üìÅ</span> Categor√≠as
                </a>
                <a href="/editor/zonas.html" class="admin-nav-item">
                    <span class="icon">üìç</span> Zonas
                </a>
                <a href="/editor/cine.html" class="admin-nav-item active">
                    <span class="icon">üé¨</span> Cine
                </a>
                <a href="/editor/gastronomia.html" class="admin-nav-item">
                    <span class="icon">üçΩÔ∏è</span> Gastronom√≠a
                </a>
                <a href="/editor/alojamiento.html" class="admin-nav-item">
                    <span class="icon">üè®</span> Alojamiento
                </a>
                <a href="/editor/transporte.html" class="admin-nav-item">
                    <span class="icon">üöå</span> Transporte
                </a>
                <a href="/editor/servicios.html" class="admin-nav-item">
                    <span class="icon">üîß</span> Servicios
                </a>
                <a href="/editor/puntos-interes.html" class="admin-nav-item">
                    <span class="icon">üìç</span> Turismo
                </a>
                <div class="admin-nav-divider"></div>
                <a href="/" class="admin-nav-item">
                    <span class="icon">üè†</span> Volver al sitio
                </a>
                <a href="#" onclick="auth.logout(); return false;" class="admin-nav-item">
                    <span class="icon">üö™</span> Cerrar sesi√≥n
                </a>
            </nav>
        </aside>

        <!-- Main content -->
        <main class="admin-main">
            <header class="admin-header">
                <h1>üé¨ Gesti√≥n de Cine</h1>
                <div class="admin-user">
                    <span id="user-name">Editor</span>
                </div>
            </header>

            <div class="admin-content">
                <!-- Tabs -->
                <div class="tabs mb-4">
                    <button class="tab-btn active" onclick="switchTab('cinemas')">üè¢ Cines</button>
                    <button class="tab-btn" onclick="switchTab('movies')">üé¨ Pel√≠culas</button>
                    <button class="tab-btn" onclick="switchTab('showtimes')">üìÖ Cartelera</button>
                </div>

                <!-- Tab: Cines -->
                <div id="tab-cinemas" class="tab-content active">
                    <div class="d-flex justify-between align-center mb-4">
                        <h2>Cines</h2>
                        <button class="btn btn-primary btn-sm" onclick="showCinemaModal()">
                            <span>‚ûï</span> Nuevo Cine
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-body" id="cinemas-container">
                            <div class="text-center p-4"><div class="spinner"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Pel√≠culas -->
                <div id="tab-movies" class="tab-content" style="display: none;">
                    <div class="d-flex justify-between align-center mb-4">
                        <h2>Pel√≠culas</h2>
                        <button class="btn btn-primary btn-sm" onclick="showMovieModal()">
                            <span>‚ûï</span> Nueva Pel√≠cula
                        </button>
                    </div>
                    <div class="d-flex gap-3 mb-4 flex-wrap">
                        <select id="filter-movie-status" class="form-control" style="max-width: 180px;" onchange="renderMovies()">
                            <option value="">Todas</option>
                            <option value="now_showing">En cartelera</option>
                            <option value="coming_soon">Pr√≥ximamente</option>
                            <option value="archived">Archivadas</option>
                        </select>
                    </div>
                    <div class="card">
                        <div class="card-body" id="movies-container">
                            <div class="text-center p-4"><div class="spinner"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Cartelera -->
                <div id="tab-showtimes" class="tab-content" style="display: none;">
                    <div class="d-flex justify-between align-center mb-4">
                        <h2>Cartelera / Funciones</h2>
                        <div class="d-flex gap-2">
                            <button class="btn btn-danger btn-sm" onclick="showCleanupModal()">
                                <span>üóëÔ∏è</span> Limpieza
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="showBulkModal()">
                                <span>üìÖ</span> Carga Masiva
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="showShowtimeModal()">
                                <span>‚ûï</span> Nueva Funci√≥n
                            </button>
                        </div>
                    </div>
                    <div class="d-flex gap-3 mb-4 flex-wrap">
                        <select id="filter-showtime-cinema" class="form-control" style="max-width: 200px;" onchange="loadShowtimes()">
                            <option value="">Todos los cines</option>
                        </select>
                        <input type="date" id="filter-showtime-date" class="form-control" style="max-width: 180px;" onchange="loadShowtimes()">
                    </div>
                    <div class="card">
                        <div class="card-body" id="showtimes-container">
                            <div class="text-center p-4"><div class="spinner"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal: Cine (3 columnas) -->
    <div class="modal-backdrop" id="cinema-modal-backdrop" onclick="closeModal('cinema')"></div>
    <div class="modal modal-large" id="cinema-modal">
        <div class="modal-header">
            <h3 class="modal-title" id="cinema-modal-title">Nuevo Cine</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeModal('cinema')">Cancelar</button>
                <button type="submit" form="cinema-form" class="btn btn-primary btn-sm">Guardar</button>
            </div>
        </div>
        <div class="modal-body">
            <form id="cinema-form" onsubmit="saveCinema(event)">
                <input type="hidden" id="cinema-id">
                <input type="hidden" id="cinema-logo">

                <div class="form-grid-3">
                    <!-- COLUMNA 1: Info Principal -->
                    <div class="form-column">
                        <h4 class="form-section-title">Informaci√≥n</h4>
                        <div class="form-group">
                            <label for="cinema-name">Nombre *</label>
                            <input type="text" id="cinema-name" class="form-control" required placeholder="Ej: Cine Hoyts">
                        </div>
                        <div class="form-group">
                            <label for="cinema-description">Descripci√≥n</label>
                            <textarea id="cinema-description" class="form-control" rows="2" placeholder="Breve descripci√≥n..."></textarea>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label for="cinema-screens">Salas</label>
                                <input type="number" id="cinema-screens" class="form-control" min="1" value="1">
                            </div>
                            <div class="form-group">
                                <label for="cinema-status">Estado</label>
                                <select id="cinema-status" class="form-control">
                                    <option value="pending">Pendiente</option>
                                    <option value="approved">Aprobado</option>
                                    <option value="rejected">Rechazado</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Caracter√≠sticas</label>
                            <div class="features-grid">
                                <label><input type="checkbox" value="3D"> 3D</label>
                                <label><input type="checkbox" value="IMAX"> IMAX</label>
                                <label><input type="checkbox" value="Dolby Atmos"> Dolby</label>
                                <label><input type="checkbox" value="4DX"> 4DX</label>
                                <label><input type="checkbox" value="Candy Bar"> Candy</label>
                                <label><input type="checkbox" value="Estacionamiento"> Parking</label>
                            </div>
                        </div>
                    </div>

                    <!-- COLUMNA 2: Ubicaci√≥n y Contacto -->
                    <div class="form-column">
                        <h4 class="form-section-title">Ubicaci√≥n y Contacto</h4>
                        <div class="form-group">
                            <label for="cinema-address">Direcci√≥n *</label>
                            <input type="text" id="cinema-address" class="form-control" required placeholder="Av. Belgrano 1234">
                        </div>
                        <div class="form-group">
                            <label for="cinema-zone">Zona</label>
                            <select id="cinema-zone" class="form-control">
                                <option value="">Seleccionar zona</option>
                            </select>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label for="cinema-phone">Tel√©fono</label>
                                <input type="tel" id="cinema-phone" class="form-control" placeholder="385 4123456">
                            </div>
                            <div class="form-group">
                                <label for="cinema-whatsapp">WhatsApp</label>
                                <input type="tel" id="cinema-whatsapp" class="form-control" placeholder="385 1234567">
                            </div>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label for="cinema-website">Web</label>
                                <input type="url" id="cinema-website" class="form-control" placeholder="https://...">
                            </div>
                            <div class="form-group">
                                <label for="cinema-instagram">Instagram</label>
                                <input type="text" id="cinema-instagram" class="form-control" placeholder="@usuario">
                            </div>
                        </div>
                    </div>

                    <!-- COLUMNA 3: Logo -->
                    <div class="form-column">
                        <h4 class="form-section-title">Logo</h4>
                        <div class="form-group">
                            <label for="cinema-logo-file">Imagen del Logo</label>
                            <input type="file" id="cinema-logo-file" class="form-control-file" accept="image/*" onchange="uploadCinemaLogo(event)">
                            <div id="cinema-logo-preview" class="image-preview-box"></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Pel√≠cula (3 columnas) -->
    <div class="modal-backdrop" id="movie-modal-backdrop" onclick="closeModal('movie')"></div>
    <div class="modal modal-large" id="movie-modal">
        <div class="modal-header">
            <h3 class="modal-title" id="movie-modal-title">Nueva Pel√≠cula</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeModal('movie')">Cancelar</button>
                <button type="submit" form="movie-form" class="btn btn-primary btn-sm">Guardar</button>
            </div>
        </div>
        <div class="modal-body">
            <form id="movie-form" onsubmit="saveMovie(event)">
                <input type="hidden" id="movie-id">
                <input type="hidden" id="movie-poster">

                <div class="form-grid-3">
                    <!-- COLUMNA 1: Info Principal -->
                    <div class="form-column">
                        <h4 class="form-section-title">Informaci√≥n</h4>
                        <div class="form-group">
                            <label for="movie-title">T√≠tulo *</label>
                            <input type="text" id="movie-title" class="form-control" required placeholder="T√≠tulo de la pel√≠cula">
                        </div>
                        <div class="form-group">
                            <label for="movie-original-title">T√≠tulo Original</label>
                            <input type="text" id="movie-original-title" class="form-control" placeholder="T√≠tulo en idioma original">
                        </div>
                        <div class="form-group">
                            <label for="movie-synopsis">Sinopsis</label>
                            <textarea id="movie-synopsis" class="form-control" rows="3" placeholder="Sinopsis..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="movie-trailer">Trailer (YouTube)</label>
                            <input type="url" id="movie-trailer" class="form-control" placeholder="https://youtube.com/watch?v=...">
                        </div>
                    </div>

                    <!-- COLUMNA 2: Detalles -->
                    <div class="form-column">
                        <h4 class="form-section-title">Detalles</h4>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label for="movie-duration">Duraci√≥n (min)</label>
                                <input type="number" id="movie-duration" class="form-control" min="1" placeholder="120">
                            </div>
                            <div class="form-group">
                                <label for="movie-rating">Clasificaci√≥n</label>
                                <select id="movie-rating" class="form-control">
                                    <option value="ATP">ATP</option>
                                    <option value="+13">+13</option>
                                    <option value="+16">+16</option>
                                    <option value="+18">+18</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="movie-genre">G√©nero</label>
                            <input type="text" id="movie-genre" class="form-control" placeholder="Acci√≥n, Comedia...">
                        </div>
                        <div class="form-group">
                            <label for="movie-director">Director</label>
                            <input type="text" id="movie-director" class="form-control" placeholder="Nombre del director">
                        </div>
                        <div class="form-group">
                            <label for="movie-cast">Actores</label>
                            <input type="text" id="movie-cast" class="form-control" placeholder="Actor 1, Actor 2...">
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label for="movie-release">Estreno</label>
                                <input type="date" id="movie-release" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="movie-status">Estado</label>
                                <select id="movie-status" class="form-control">
                                    <option value="now_showing">En Cartelera</option>
                                    <option value="coming_soon">Pr√≥ximamente</option>
                                    <option value="archived">Archivada</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- COLUMNA 3: Poster -->
                    <div class="form-column">
                        <h4 class="form-section-title">Poster</h4>
                        <div class="form-group">
                            <label for="movie-poster-file">Imagen del Poster</label>
                            <input type="file" id="movie-poster-file" class="form-control-file" accept="image/*" onchange="uploadMoviePoster(event)">
                            <div id="movie-poster-preview" class="image-preview-box poster"></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Funci√≥n (compacto 2 columnas) -->
    <div class="modal-backdrop" id="showtime-modal-backdrop" onclick="closeModal('showtime')"></div>
    <div class="modal modal-compact" id="showtime-modal">
        <div class="modal-header">
            <h3 class="modal-title" id="showtime-modal-title">Nueva Funci√≥n</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeModal('showtime')">Cancelar</button>
                <button type="submit" form="showtime-form" class="btn btn-primary btn-sm">Guardar</button>
            </div>
        </div>
        <div class="modal-body">
            <form id="showtime-form" onsubmit="saveShowtime(event)">
                <input type="hidden" id="showtime-id">

                <div class="form-grid-2">
                    <div class="form-group">
                        <label for="showtime-cinema">Cine *</label>
                        <select id="showtime-cinema" class="form-control" required>
                            <option value="">Seleccionar cine</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pel√≠cula *</label>
                        <div class="searchable-select" id="showtime-movie-select">
                            <div class="searchable-select-trigger" onclick="toggleShowtimeMovieSearch()">
                                <span id="showtime-movie-text">Seleccionar pel√≠cula</span>
                                <span class="searchable-select-arrow">‚ñº</span>
                            </div>
                            <input type="hidden" id="showtime-movie" value="">
                            <div class="searchable-select-dropdown" id="showtime-movie-dropdown">
                                <input type="text" class="searchable-select-input" id="showtime-movie-search"
                                    placeholder="üîç Buscar pel√≠cula..." oninput="filterShowtimeMovieOptions()">
                                <div class="searchable-select-options" id="showtime-movie-options"></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="showtime-date">Fecha *</label>
                        <input type="date" id="showtime-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="showtime-time">Hora *</label>
                        <input type="time" id="showtime-time" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="showtime-screen">Sala</label>
                        <input type="number" id="showtime-screen" class="form-control" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="showtime-format">Formato</label>
                        <select id="showtime-format" class="form-control">
                            <option value="2D">2D</option>
                            <option value="3D">3D</option>
                            <option value="IMAX">IMAX</option>
                            <option value="4DX">4DX</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="showtime-language">Idioma</label>
                        <select id="showtime-language" class="form-control">
                            <option value="subtitulada">Subtitulada</option>
                            <option value="doblada">Doblada</option>
                            <option value="original">Original</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="showtime-price">Precio $</label>
                        <input type="number" id="showtime-price" class="form-control" step="0.01" min="0" placeholder="0">
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Carga Masiva de Funciones -->
    <div class="modal-backdrop" id="bulk-modal-backdrop" onclick="closeModal('bulk')"></div>
    <div class="modal modal-large" id="bulk-modal">
        <div class="modal-header">
            <h3 class="modal-title">Carga Masiva de Funciones</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeModal('bulk')">Cancelar</button>
                <button type="button" class="btn btn-primary btn-sm" onclick="saveBulkShowtimes()">Crear Funciones</button>
            </div>
        </div>
        <div class="modal-body">
            <div class="bulk-instructions">
                <strong>Como usar:</strong>
                1. Seleccion√° cine y pel√≠cula |
                2. Eleg√≠ rango de fechas |
                3. Agreg√° los horarios |
                4. Opcional: eleg√≠ d√≠as espec√≠ficos
            </div>

            <div class="form-grid-3">
                <!-- COLUMNA 1: Cine y Pel√≠cula -->
                <div class="form-column">
                    <h4 class="form-section-title">Cine y Pel√≠cula</h4>
                    <div class="form-group">
                        <label for="bulk-cinema">Cine *</label>
                        <select id="bulk-cinema" class="form-control" required>
                            <option value="">Seleccionar cine</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pel√≠cula *</label>
                        <div class="searchable-select" id="bulk-movie-select">
                            <div class="searchable-select-trigger" onclick="toggleMovieSearch()">
                                <span id="bulk-movie-text">Seleccionar pel√≠cula</span>
                                <span class="searchable-select-arrow">‚ñº</span>
                            </div>
                            <input type="hidden" id="bulk-movie" value="">
                            <div class="searchable-select-dropdown" id="bulk-movie-dropdown">
                                <input type="text" class="searchable-select-input" id="bulk-movie-search"
                                    placeholder="üîç Buscar pel√≠cula..." oninput="filterMovieOptions()">
                                <div class="searchable-select-options" id="bulk-movie-options"></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row-2">
                        <div class="form-group">
                            <label for="bulk-format">Formato</label>
                            <select id="bulk-format" class="form-control">
                                <option value="2D">2D</option>
                                <option value="3D">3D</option>
                                <option value="IMAX">IMAX</option>
                                <option value="4DX">4DX</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="bulk-language">Idioma</label>
                            <select id="bulk-language" class="form-control">
                                <option value="subtitulada">Subtitulada</option>
                                <option value="doblada">Doblada</option>
                                <option value="original">Original</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row-2">
                        <div class="form-group">
                            <label for="bulk-screen">Sala</label>
                            <input type="number" id="bulk-screen" class="form-control" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="bulk-price">Precio $</label>
                            <input type="number" id="bulk-price" class="form-control" step="0.01" min="0" value="0">
                        </div>
                    </div>
                </div>

                <!-- COLUMNA 2: Fechas y D√≠as -->
                <div class="form-column">
                    <h4 class="form-section-title">Fechas</h4>
                    <div class="form-group">
                        <label for="bulk-date-from">Desde *</label>
                        <input type="date" id="bulk-date-from" class="form-control" required onchange="updateBulkPreview()">
                    </div>
                    <div class="form-group">
                        <label for="bulk-date-to">Hasta *</label>
                        <input type="date" id="bulk-date-to" class="form-control" required onchange="updateBulkPreview()">
                    </div>
                    <div class="form-group">
                        <label>D√≠as de la semana</label>
                        <div class="days-grid">
                            <label><input type="checkbox" value="1" checked onchange="updateBulkPreview()"> Lun</label>
                            <label><input type="checkbox" value="2" checked onchange="updateBulkPreview()"> Mar</label>
                            <label><input type="checkbox" value="3" checked onchange="updateBulkPreview()"> Mi√©</label>
                            <label><input type="checkbox" value="4" checked onchange="updateBulkPreview()"> Jue</label>
                            <label><input type="checkbox" value="5" checked onchange="updateBulkPreview()"> Vie</label>
                            <label><input type="checkbox" value="6" checked onchange="updateBulkPreview()"> S√°b</label>
                            <label><input type="checkbox" value="0" checked onchange="updateBulkPreview()"> Dom</label>
                        </div>
                    </div>
                </div>

                <!-- COLUMNA 3: Horarios -->
                <div class="form-column">
                    <h4 class="form-section-title">Horarios</h4>
                    <div class="form-group">
                        <label>Agregar horario</label>
                        <div class="d-flex gap-2">
                            <input type="time" id="bulk-new-time" class="form-control" style="flex:1;">
                            <button type="button" class="btn btn-primary btn-sm" onclick="addBulkTime()">+</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Horarios seleccionados</label>
                        <div id="bulk-times-list" class="times-list">
                            <span class="text-muted">Ning√∫n horario agregado</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Horarios r√°pidos</label>
                        <div class="quick-times">
                            <button type="button" class="btn btn-outline btn-xs" onclick="addQuickTime('14:00')">14:00</button>
                            <button type="button" class="btn btn-outline btn-xs" onclick="addQuickTime('16:30')">16:30</button>
                            <button type="button" class="btn btn-outline btn-xs" onclick="addQuickTime('19:00')">19:00</button>
                            <button type="button" class="btn btn-outline btn-xs" onclick="addQuickTime('21:30')">21:30</button>
                            <button type="button" class="btn btn-outline btn-xs" onclick="addQuickTime('00:00')">00:00</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview -->
            <div class="bulk-preview">
                <strong>Vista previa:</strong> <span id="bulk-preview-text">0 funciones ser√°n creadas</span>
            </div>
        </div>
    </div>

    <!-- Modal: Limpieza de Funciones -->
    <div class="modal-backdrop" id="cleanup-modal-backdrop" onclick="closeModal('cleanup')"></div>
    <div class="modal modal-compact" id="cleanup-modal">
        <div class="modal-header">
            <h3 class="modal-title">üóëÔ∏è Limpieza de Funciones</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeModal('cleanup')">Cancelar</button>
                <button type="button" class="btn btn-danger btn-sm" onclick="executeCleanup()" id="cleanup-btn" disabled>Eliminar</button>
            </div>
        </div>
        <div class="modal-body">
            <div class="cleanup-instructions">
                <strong>Filtros:</strong> Seleccion√° qu√© funciones eliminar. Pod√©s combinar pel√≠cula + fechas.
            </div>

            <div class="form-group">
                <label>Pel√≠cula (opcional)</label>
                <div class="searchable-select" id="cleanup-movie-select">
                    <div class="searchable-select-trigger" onclick="toggleCleanupMovieSearch()">
                        <span id="cleanup-movie-text">Todas las pel√≠culas</span>
                        <span class="searchable-select-arrow">‚ñº</span>
                    </div>
                    <input type="hidden" id="cleanup-movie" value="">
                    <div class="searchable-select-dropdown" id="cleanup-movie-dropdown">
                        <input type="text" class="searchable-select-input" id="cleanup-movie-search"
                            placeholder="üîç Buscar pel√≠cula..." oninput="filterCleanupMovieOptions()">
                        <div class="searchable-select-options" id="cleanup-movie-options"></div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Cine (opcional)</label>
                <select id="cleanup-cinema" class="form-control" onchange="updateCleanupPreview()">
                    <option value="">Todos los cines</option>
                </select>
            </div>

            <div class="form-row-2">
                <div class="form-group">
                    <label>Desde fecha</label>
                    <input type="date" id="cleanup-date-from" class="form-control" onchange="updateCleanupPreview()">
                </div>
                <div class="form-group">
                    <label>Hasta fecha</label>
                    <input type="date" id="cleanup-date-to" class="form-control" onchange="updateCleanupPreview()">
                </div>
            </div>

            <div class="form-group">
                <label class="d-flex align-center gap-2">
                    <input type="checkbox" id="cleanup-past-only" onchange="updateCleanupPreview()">
                    Solo funciones pasadas (antes de hoy)
                </label>
            </div>

            <!-- Preview -->
            <div class="cleanup-preview" id="cleanup-preview">
                <div class="cleanup-preview-count">
                    <span id="cleanup-count">0</span> funciones ser√°n eliminadas
                </div>
                <div class="cleanup-preview-list" id="cleanup-list"></div>
            </div>
        </div>
    </div>

    <style>
        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0;
        }
        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--text-muted);
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }
        .tab-btn:hover { color: var(--primary); }
        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            font-weight: 600;
        }

        /* Modal Large (3 columnas) */
        .modal-large {
            max-width: 950px !important;
            width: 95% !important;
        }
        .modal-compact {
            max-width: 550px !important;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
        }
        .modal-header-actions {
            display: flex;
            gap: 0.5rem;
        }
        .modal-body {
            padding: 1rem 1.25rem !important;
        }

        /* Grid 3 columnas */
        .form-grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
        }
        @media (max-width: 900px) {
            .form-grid-3 { grid-template-columns: 1fr; }
        }

        /* Grid 2 columnas */
        .form-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        @media (max-width: 600px) {
            .form-grid-2 { grid-template-columns: 1fr; }
        }

        /* Columnas de formulario */
        .form-column {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .form-section-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary);
            margin: 0 0 0.5rem 0;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid var(--border-color);
        }

        /* Form groups compactos */
        .form-group {
            margin-bottom: 0.4rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.2rem;
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--text-primary);
        }
        .form-control {
            padding: 0.4rem 0.6rem;
            font-size: 0.85rem;
        }
        textarea.form-control {
            resize: vertical;
            min-height: 50px;
        }

        /* Row 2 columnas dentro de columna */
        .form-row-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        /* Features grid */
        .features-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.25rem;
        }
        .features-grid label {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.75rem;
            font-weight: normal;
            cursor: pointer;
        }
        .features-grid input[type="checkbox"] {
            width: 14px;
            height: 14px;
        }

        /* Preview de imagen */
        .image-preview-box {
            margin-top: 0.5rem;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            overflow: hidden;
        }
        .image-preview-box.poster {
            min-height: 180px;
        }
        .image-preview-box img {
            max-width: 100%;
            max-height: 180px;
            object-fit: contain;
            border-radius: 4px;
        }
        .form-control-file {
            padding: 0.4rem;
            font-size: 0.75rem;
            border: 2px dashed var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            background: #f8f9fa;
        }
        .form-control-file:hover {
            border-color: var(--primary);
        }

        /* Legacy form-row for compatibility */
        .form-row {
            display: flex;
            gap: 1rem;
        }
        .form-row .form-group {
            flex: 1;
        }
        .features-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .features-checkboxes label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .image-preview-small {
            max-width: 150px;
            max-height: 100px;
            border-radius: 8px;
            overflow: hidden;
        }
        .image-preview-small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .movie-card {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        .movie-poster {
            width: 80px;
            height: 120px;
            background: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }
        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .movie-info { flex: 1; }
        .movie-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }
        .cinema-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 0.75rem;
        }
        .cinema-info h4 { margin: 0 0 0.25rem 0; }
        .cinema-address { font-size: 0.85rem; color: var(--text-muted); }
        .showtime-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        .showtime-info { display: flex; gap: 1rem; align-items: center; }
        .showtime-time {
            font-size: 1.1rem;
            font-weight: 600;
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
        }

        /* Bulk Modal Styles */
        .bulk-instructions {
            background: rgba(168, 85, 247, 0.15);
            border: 1px solid rgba(168, 85, 247, 0.4);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #e9d5ff;
        }
        .days-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.25rem;
        }
        .days-grid label {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.75rem;
            font-weight: normal;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            background: rgba(30, 30, 40, 0.8);
            color: #e0e0e0;
        }
        .days-grid label:hover {
            background: rgba(168, 85, 247, 0.3);
        }
        .days-grid input[type="checkbox"] {
            width: 14px;
            height: 14px;
        }
        .times-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 40px;
            padding: 0.5rem;
            background: rgba(30, 30, 40, 0.8);
            border-radius: 6px;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }
        .time-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .time-tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .time-tag button:hover {
            opacity: 1;
        }
        .quick-times {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        .btn-xs {
            padding: 0.2rem 0.5rem;
            font-size: 0.75rem;
        }
        .bulk-preview {
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #e9d5ff;
            text-align: center;
        }

        /* Searchable Select */
        .searchable-select {
            position: relative;
        }
        .searchable-select-trigger {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0.6rem;
            font-size: 0.85rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .searchable-select-trigger:hover {
            border-color: var(--primary);
        }
        .searchable-select-arrow {
            font-size: 0.7rem;
            opacity: 0.6;
        }
        .searchable-select-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--primary);
            border-radius: 6px;
            margin-top: 4px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-height: 280px;
            overflow: hidden;
        }
        .searchable-select-dropdown.active {
            display: block;
        }
        .searchable-select-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: none;
            border-bottom: 1px solid var(--border-color);
            background: rgba(168, 85, 247, 0.1);
            color: var(--text-primary);
            font-size: 0.85rem;
            outline: none;
        }
        .searchable-select-input::placeholder {
            color: var(--text-muted);
        }
        .searchable-select-options {
            max-height: 220px;
            overflow-y: auto;
        }
        .searchable-select-option {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            font-size: 0.85rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .searchable-select-option:hover {
            background: rgba(168, 85, 247, 0.2);
        }
        .searchable-select-option.selected {
            background: rgba(168, 85, 247, 0.3);
        }
        .searchable-select-option-poster {
            width: 30px;
            height: 45px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
            flex-shrink: 0;
        }
        .searchable-select-option-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .searchable-select-option-info {
            flex: 1;
            min-width: 0;
        }
        .searchable-select-option-title {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .searchable-select-option-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .searchable-select-empty {
            padding: 1rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Cleanup Modal Styles */
        .cleanup-instructions {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #fca5a5;
        }
        .cleanup-preview {
            background: rgba(30, 30, 40, 0.8);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        .cleanup-preview-count {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ef4444;
            margin-bottom: 0.75rem;
            text-align: center;
        }
        .cleanup-preview-list {
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .cleanup-preview-item {
            padding: 0.35rem 0.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
        }
        .cleanup-preview-item:last-child {
            border-bottom: none;
        }
    </style>

    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/components.js"></script>
    <script>
        // Verificar auth
        if (!auth.getUser()) {}
        document.getElementById('user-name').textContent = auth.getUser()?.name || 'Editor';

        let cinemas = [];
        let movies = [];
        let showtimes = [];
        let zones = [];
        let currentTab = 'cinemas';

        // ========== TABS ==========
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');

            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`tab-${tab}`).style.display = 'block';

            if (tab === 'showtimes') loadShowtimes();
        }

        // ========== LOAD DATA ==========
        async function loadData() {
            try {
                const [cinemasRes, moviesRes, zonesRes] = await Promise.all([
                    api.getAdminCinemas(),
                    api.getAdminMovies(),
                    api.getAdminZones()
                ]);

                if (cinemasRes.success) {
                    cinemas = cinemasRes.data || [];
                    renderCinemas();
                    populateCinemaSelects();
                }

                if (moviesRes.success) {
                    movies = moviesRes.data || [];
                    renderMovies();
                    populateMovieSelects();
                }

                if (zonesRes.success) {
                    zones = zonesRes.data || [];
                    populateZoneSelects();
                }
            } catch (e) {
                console.error('Error loading data:', e);
                Components.toast('Error cargando datos', 'error');
            }
        }

        async function loadShowtimes() {
            const cinemaId = document.getElementById('filter-showtime-cinema').value;
            const date = document.getElementById('filter-showtime-date').value;

            try {
                const params = {};
                if (cinemaId) params.cinema_id = cinemaId;
                if (date) params.date = date;

                const res = await api.getAdminShowtimes(params);
                if (res.success) {
                    showtimes = res.data || [];
                    renderShowtimes();
                }
            } catch (e) {
                console.error('Error loading showtimes:', e);
            }
        }

        // ========== RENDER ==========
        function renderCinemas() {
            const container = document.getElementById('cinemas-container');
            if (cinemas.length === 0) {
                container.innerHTML = '<p class="text-center text-muted p-4">No hay cines registrados</p>';
                return;
            }

            container.innerHTML = cinemas.map(c => `
                <div class="cinema-card">
                    <div class="cinema-info">
                        <h4>${c.name}</h4>
                        <div class="cinema-address">${c.address || 'Sin direcci√≥n'} ${c.zone_name ? `‚Ä¢ ${c.zone_name}` : ''}</div>
                        <div class="cinema-address">${c.total_screens || 1} sala(s) ‚Ä¢ ${c.status === 'approved' ? '‚úÖ Aprobado' : c.status === 'pending' ? '‚è≥ Pendiente' : '‚ùå Rechazado'}</div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline" onclick="editCinema(${c.id})">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCinema(${c.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function renderMovies() {
            const container = document.getElementById('movies-container');
            const statusFilter = document.getElementById('filter-movie-status').value;

            let filtered = movies;
            if (statusFilter) {
                filtered = movies.filter(m => m.status === statusFilter);
            }

            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-center text-muted p-4">No hay pel√≠culas</p>';
                return;
            }

            container.innerHTML = filtered.map(m => `
                <div class="movie-card">
                    <div class="movie-poster">
                        ${m.poster_url ? `<img src="${m.poster_url}" alt="${m.title}">` : 'üé¨'}
                    </div>
                    <div class="movie-info">
                        <h4 style="margin: 0;">${m.title}</h4>
                        <div class="movie-meta">
                            ${m.duration ? `${m.duration} min` : ''}
                            ${m.rating ? `‚Ä¢ ${m.rating}` : ''}
                            ${m.genre ? `‚Ä¢ ${m.genre}` : ''}
                        </div>
                        <div class="movie-meta">${m.director ? `Director: ${m.director}` : ''}</div>
                        <span class="badge badge-${m.status === 'now_showing' ? 'success' : m.status === 'coming_soon' ? 'warning' : 'secondary'}">
                            ${m.status === 'now_showing' ? 'En Cartelera' : m.status === 'coming_soon' ? 'Pr√≥ximamente' : 'Archivada'}
                        </span>
                    </div>
                    <div class="btn-group" style="flex-shrink: 0;">
                        <button class="btn btn-sm btn-outline" onclick="editMovie(${m.id})">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteMovie(${m.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function renderShowtimes() {
            const container = document.getElementById('showtimes-container');
            if (showtimes.length === 0) {
                container.innerHTML = '<p class="text-center text-muted p-4">No hay funciones para mostrar. Selecciona un cine o fecha.</p>';
                return;
            }

            container.innerHTML = showtimes.map(s => `
                <div class="showtime-row">
                    <div class="showtime-info">
                        <span class="showtime-time">${s.show_time}</span>
                        <div>
                            <strong>${s.movie_title}</strong><br>
                            <small class="text-muted">${s.cinema_name} ‚Ä¢ Sala ${s.screen_number || 1} ‚Ä¢ ${s.format} ${s.language}</small>
                        </div>
                    </div>
                    <div class="btn-group">
                        <span class="badge badge-info">$${s.price || 0}</span>
                        <button class="btn btn-sm btn-outline" onclick="editShowtime(${s.id})">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteShowtime(${s.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // ========== POPULATE SELECTS ==========
        function populateCinemaSelects() {
            const html = '<option value="">Seleccionar cine</option>' +
                cinemas.filter(c => c.status === 'approved').map(c => `<option value="${c.id}">${c.name}</option>`).join('');

            document.getElementById('showtime-cinema').innerHTML = html;
            document.getElementById('filter-showtime-cinema').innerHTML = '<option value="">Todos los cines</option>' +
                cinemas.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        function populateMovieSelects() {
            // Movies now use searchable select - no need to populate regular selects
        }

        function populateZoneSelects() {
            const html = '<option value="">Seleccionar zona</option>' +
                zones.filter(z => z.is_active).map(z => `<option value="${z.id}">${z.name}</option>`).join('');
            document.getElementById('cinema-zone').innerHTML = html;
        }

        // ========== MODALS ==========
        function openModal(type) {
            document.getElementById(`${type}-modal`).classList.add('active');
            document.getElementById(`${type}-modal-backdrop`).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(type) {
            document.getElementById(`${type}-modal`).classList.remove('active');
            document.getElementById(`${type}-modal-backdrop`).classList.remove('active');
            document.body.style.overflow = '';
        }

        // ========== CINEMA CRUD ==========
        function showCinemaModal() {
            document.getElementById('cinema-modal-title').textContent = 'Nuevo Cine';
            document.getElementById('cinema-form').reset();
            document.getElementById('cinema-id').value = '';
            document.getElementById('cinema-logo').value = '';
            document.getElementById('cinema-logo-preview').innerHTML = '';
            document.querySelectorAll('.features-checkboxes input').forEach(cb => cb.checked = false);
            openModal('cinema');
        }

        function editCinema(id) {
            const cinema = cinemas.find(c => c.id === id);
            if (!cinema) return;

            document.getElementById('cinema-modal-title').textContent = 'Editar Cine';
            document.getElementById('cinema-id').value = cinema.id;
            document.getElementById('cinema-name').value = cinema.name || '';
            document.getElementById('cinema-description').value = cinema.description || '';
            document.getElementById('cinema-address').value = cinema.address || '';
            document.getElementById('cinema-zone').value = cinema.zone_id || '';
            document.getElementById('cinema-phone').value = cinema.phone || '';
            document.getElementById('cinema-whatsapp').value = cinema.whatsapp || '';
            document.getElementById('cinema-website').value = cinema.website || '';
            document.getElementById('cinema-instagram').value = cinema.instagram || '';
            document.getElementById('cinema-screens').value = cinema.total_screens || 1;
            document.getElementById('cinema-status').value = cinema.status || 'pending';
            document.getElementById('cinema-logo').value = cinema.logo_url || '';

            if (cinema.logo_url) {
                document.getElementById('cinema-logo-preview').innerHTML = `<img src="${cinema.logo_url}">`;
            }

            // Features
            const features = cinema.features ? JSON.parse(cinema.features) : [];
            document.querySelectorAll('.features-checkboxes input').forEach(cb => {
                cb.checked = features.includes(cb.value);
            });

            openModal('cinema');
        }

        async function saveCinema(event) {
            event.preventDefault();

            const features = [];
            document.querySelectorAll('.features-checkboxes input:checked').forEach(cb => {
                features.push(cb.value);
            });

            const data = {
                name: document.getElementById('cinema-name').value,
                description: document.getElementById('cinema-description').value || null,
                address: document.getElementById('cinema-address').value,
                zone_id: document.getElementById('cinema-zone').value || null,
                phone: document.getElementById('cinema-phone').value || null,
                whatsapp: document.getElementById('cinema-whatsapp').value || null,
                website: document.getElementById('cinema-website').value || null,
                instagram: document.getElementById('cinema-instagram').value || null,
                total_screens: parseInt(document.getElementById('cinema-screens').value) || 1,
                logo_url: document.getElementById('cinema-logo').value || null,
                features: features.length > 0 ? features : null,
                status: document.getElementById('cinema-status').value
            };

            const cinemaId = document.getElementById('cinema-id').value;

            try {
                const res = cinemaId
                    ? await api.updateCinema(cinemaId, data)
                    : await api.createCinema(data);

                if (res.success) {
                    Components.toast(cinemaId ? 'Cine actualizado' : 'Cine creado', 'success');
                    closeModal('cinema');
                    loadData();
                }
            } catch (e) {
                Components.toast(e.message || 'Error guardando cine', 'error');
            }
        }

        async function deleteCinema(id) {
            if (!confirm('¬øEliminar este cine? Se eliminar√°n tambi√©n todas sus funciones.')) return;
            try {
                const res = await api.deleteCinema(id);
                if (res.success) {
                    Components.toast('Cine eliminado', 'success');
                    loadData();
                }
            } catch (e) {
                Components.toast('Error eliminando cine', 'error');
            }
        }

        // ========== MOVIE CRUD ==========
        function showMovieModal() {
            document.getElementById('movie-modal-title').textContent = 'Nueva Pel√≠cula';
            document.getElementById('movie-form').reset();
            document.getElementById('movie-id').value = '';
            document.getElementById('movie-poster').value = '';
            document.getElementById('movie-poster-preview').innerHTML = '';
            openModal('movie');
        }

        // Helper para parsear JSON arrays (genre, cast) - evita double encoding
        function parseJsonArray(value) {
            if (!value) return '';
            if (Array.isArray(value)) return value.join(', ');
            if (typeof value === 'string') {
                try {
                    // Intentar parsear hasta obtener un array limpio
                    let parsed = value;
                    let maxIterations = 5; // evitar loop infinito
                    while (typeof parsed === 'string' && maxIterations > 0) {
                        parsed = JSON.parse(parsed);
                        maxIterations--;
                    }
                    if (Array.isArray(parsed)) return parsed.join(', ');
                    return String(parsed);
                } catch (e) {
                    return value; // Si no es JSON v√°lido, devolver como est√°
                }
            }
            return String(value);
        }

        function editMovie(id) {
            const movie = movies.find(m => m.id === id);
            if (!movie) return;

            document.getElementById('movie-modal-title').textContent = 'Editar Pel√≠cula';
            document.getElementById('movie-id').value = movie.id;
            document.getElementById('movie-title').value = movie.title || '';
            document.getElementById('movie-original-title').value = movie.original_title || '';
            document.getElementById('movie-synopsis').value = movie.synopsis || '';
            document.getElementById('movie-duration').value = movie.duration || '';
            document.getElementById('movie-rating').value = movie.rating || 'ATP';
            document.getElementById('movie-genre').value = parseJsonArray(movie.genre);
            document.getElementById('movie-director').value = movie.director || '';
            document.getElementById('movie-release').value = movie.release_date || '';
            document.getElementById('movie-cast').value = parseJsonArray(movie.cast);
            document.getElementById('movie-trailer').value = movie.trailer_url || '';
            document.getElementById('movie-status').value = movie.status || 'now_showing';
            document.getElementById('movie-poster').value = movie.poster_url || '';

            if (movie.poster_url) {
                document.getElementById('movie-poster-preview').innerHTML = `<img src="${movie.poster_url}">`;
            }

            openModal('movie');
        }

        async function saveMovie(event) {
            event.preventDefault();

            const genreText = document.getElementById('movie-genre').value;
            const castText = document.getElementById('movie-cast').value;

            const data = {
                title: document.getElementById('movie-title').value,
                original_title: document.getElementById('movie-original-title').value || null,
                synopsis: document.getElementById('movie-synopsis').value || null,
                duration: parseInt(document.getElementById('movie-duration').value) || null,
                rating: document.getElementById('movie-rating').value,
                genre: genreText ? genreText.split(',').map(g => g.trim()) : null,
                director: document.getElementById('movie-director').value || null,
                release_date: document.getElementById('movie-release').value || null,
                cast: castText ? castText.split(',').map(c => c.trim()) : null,
                trailer_url: document.getElementById('movie-trailer').value || null,
                poster_url: document.getElementById('movie-poster').value || null,
                status: document.getElementById('movie-status').value
            };

            const movieId = document.getElementById('movie-id').value;

            try {
                const res = movieId
                    ? await api.updateMovie(movieId, data)
                    : await api.createMovie(data);

                if (res.success) {
                    Components.toast(movieId ? 'Pel√≠cula actualizada' : 'Pel√≠cula creada', 'success');
                    closeModal('movie');
                    loadData();
                }
            } catch (e) {
                Components.toast(e.message || 'Error guardando pel√≠cula', 'error');
            }
        }

        async function deleteMovie(id) {
            if (!confirm('¬øEliminar esta pel√≠cula? Se eliminar√°n tambi√©n todas sus funciones.')) return;
            try {
                const res = await api.deleteMovie(id);
                if (res.success) {
                    Components.toast('Pel√≠cula eliminada', 'success');
                    loadData();
                }
            } catch (e) {
                Components.toast('Error eliminando pel√≠cula', 'error');
            }
        }

        // ========== SHOWTIME CRUD ==========
        function showShowtimeModal() {
            document.getElementById('showtime-modal-title').textContent = 'Nueva Funci√≥n';
            document.getElementById('showtime-form').reset();
            document.getElementById('showtime-id').value = '';
            document.getElementById('showtime-date').value = new Date().toISOString().split('T')[0];
            showtimeMovieSearch.reset();
            openModal('showtime');
        }

        function editShowtime(id) {
            const st = showtimes.find(s => s.id === id);
            if (!st) return;

            document.getElementById('showtime-modal-title').textContent = 'Editar Funci√≥n';
            document.getElementById('showtime-id').value = st.id;
            document.getElementById('showtime-cinema').value = st.cinema_id;
            showtimeMovieSearch.setValue(st.movie_id);
            document.getElementById('showtime-date').value = st.show_date;
            document.getElementById('showtime-time').value = st.show_time;
            document.getElementById('showtime-screen').value = st.screen_number || 1;
            document.getElementById('showtime-format').value = st.format || '2D';
            document.getElementById('showtime-language').value = st.language || 'subtitulada';
            document.getElementById('showtime-price').value = st.price || 0;

            openModal('showtime');
        }

        async function saveShowtime(event) {
            event.preventDefault();

            const data = {
                cinema_id: document.getElementById('showtime-cinema').value,
                movie_id: document.getElementById('showtime-movie').value,
                show_date: document.getElementById('showtime-date').value,
                show_time: document.getElementById('showtime-time').value,
                screen_number: parseInt(document.getElementById('showtime-screen').value) || 1,
                format: document.getElementById('showtime-format').value,
                language: document.getElementById('showtime-language').value,
                price: parseFloat(document.getElementById('showtime-price').value) || 0
            };

            const showtimeId = document.getElementById('showtime-id').value;

            try {
                const res = showtimeId
                    ? await api.updateShowtime(showtimeId, data)
                    : await api.createShowtime(data);

                if (res.success) {
                    Components.toast(showtimeId ? 'Funci√≥n actualizada' : 'Funci√≥n creada', 'success');
                    closeModal('showtime');
                    loadShowtimes();
                }
            } catch (e) {
                Components.toast(e.message || 'Error guardando funci√≥n', 'error');
            }
        }

        async function deleteShowtime(id) {
            if (!confirm('¬øEliminar esta funci√≥n?')) return;
            try {
                const res = await api.deleteShowtime(id);
                if (res.success) {
                    Components.toast('Funci√≥n eliminada', 'success');
                    loadShowtimes();
                }
            } catch (e) {
                Components.toast('Error eliminando funci√≥n', 'error');
            }
        }

        // ========== IMAGE UPLOAD ==========
        function uploadCinemaLogo(event) {
            uploadImage(event, 'cinema-logo', 'cinema-logo-preview');
        }

        function uploadMoviePoster(event) {
            uploadImage(event, 'movie-poster', 'movie-poster-preview');
        }

        function uploadImage(event, inputId, previewId) {
            const file = event.target.files[0];
            if (!file) return;

            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                Components.toast('Tipo de archivo no permitido', 'error');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                Components.toast('Archivo muy grande (m√°x 10MB)', 'error');
                return;
            }

            // Comprimir imagen antes de guardar
            compressImage(file, 800, 0.7).then(compressedBase64 => {
                document.getElementById(inputId).value = compressedBase64;
                document.getElementById(previewId).innerHTML = `<img src="${compressedBase64}">`;
                Components.toast('Imagen cargada y comprimida', 'success');
            }).catch(err => {
                Components.toast('Error procesando imagen', 'error');
                console.error(err);
            });
        }

        // Funci√≥n para comprimir im√°genes
        function compressImage(file, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        // Redimensionar si es muy grande
                        if (width > maxWidth) {
                            height = Math.round((height * maxWidth) / width);
                            width = maxWidth;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        // Convertir a JPEG comprimido
                        const compressedBase64 = canvas.toDataURL('image/jpeg', quality);
                        resolve(compressedBase64);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // ========== SEARCHABLE SELECT ==========
        // Generic searchable select functions
        function createMovieSearchFunctions(prefix) {
            return {
                isOpen: false,
                toggle: function() {
                    const dropdown = document.getElementById(`${prefix}-movie-dropdown`);
                    this.isOpen = !this.isOpen;

                    if (this.isOpen) {
                        dropdown.classList.add('active');
                        document.getElementById(`${prefix}-movie-search`).focus();
                        this.render();
                    } else {
                        dropdown.classList.remove('active');
                    }
                },
                close: function() {
                    this.isOpen = false;
                    document.getElementById(`${prefix}-movie-dropdown`).classList.remove('active');
                },
                render: function(filter = '') {
                    const container = document.getElementById(`${prefix}-movie-options`);
                    const selectedId = document.getElementById(`${prefix}-movie`).value;

                    let filtered = movies.filter(m => m.status === 'now_showing' || m.status === 'coming_soon');

                    if (filter) {
                        const search = filter.toLowerCase();
                        filtered = filtered.filter(m =>
                            m.title.toLowerCase().includes(search) ||
                            (m.original_title && m.original_title.toLowerCase().includes(search)) ||
                            (m.director && m.director.toLowerCase().includes(search))
                        );
                    }

                    if (filtered.length === 0) {
                        container.innerHTML = '<div class="searchable-select-empty">No se encontraron pel√≠culas</div>';
                        return;
                    }

                    container.innerHTML = filtered.map(m => `
                        <div class="searchable-select-option ${m.id == selectedId ? 'selected' : ''}"
                             onclick="${prefix}MovieSearch.select(${m.id}, '${m.title.replace(/'/g, "\\'")}')">
                            <div class="searchable-select-option-poster">
                                ${m.poster_url ? `<img src="${m.poster_url}" alt="">` : 'üé¨'}
                            </div>
                            <div class="searchable-select-option-info">
                                <div class="searchable-select-option-title">${m.title}</div>
                                <div class="searchable-select-option-meta">
                                    ${m.duration ? m.duration + ' min' : ''}
                                    ${m.rating ? '‚Ä¢ ' + m.rating : ''}
                                    ${m.status === 'coming_soon' ? '‚Ä¢ Pr√≥ximamente' : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');
                },
                filter: function() {
                    const search = document.getElementById(`${prefix}-movie-search`).value;
                    this.render(search);
                },
                select: function(id, title) {
                    document.getElementById(`${prefix}-movie`).value = id;
                    document.getElementById(`${prefix}-movie-text`).textContent = title;
                    this.close();
                },
                reset: function() {
                    document.getElementById(`${prefix}-movie`).value = '';
                    document.getElementById(`${prefix}-movie-text`).textContent = 'Seleccionar pel√≠cula';
                    document.getElementById(`${prefix}-movie-search`).value = '';
                    this.close();
                },
                setValue: function(id) {
                    const movie = movies.find(m => m.id == id);
                    if (movie) {
                        document.getElementById(`${prefix}-movie`).value = id;
                        document.getElementById(`${prefix}-movie-text`).textContent = movie.title;
                    }
                }
            };
        }

        // Create instances for all modals
        const bulkMovieSearch = createMovieSearchFunctions('bulk');
        const showtimeMovieSearch = createMovieSearchFunctions('showtime');
        const cleanupMovieSearch = createMovieSearchFunctions('cleanup');

        // Override cleanup to allow "all movies" option
        cleanupMovieSearch.render = function(filter = '') {
            const container = document.getElementById('cleanup-movie-options');
            const selectedId = document.getElementById('cleanup-movie').value;

            // Add "All movies" option
            let html = `<div class="searchable-select-option ${selectedId === '' ? 'selected' : ''}"
                 onclick="cleanupMovieSearch.select('', 'Todas las pel√≠culas')">
                <div class="searchable-select-option-info">
                    <div class="searchable-select-option-title">üìã Todas las pel√≠culas</div>
                </div>
            </div>`;

            let filtered = movies;
            if (filter) {
                const search = filter.toLowerCase();
                filtered = filtered.filter(m =>
                    m.title.toLowerCase().includes(search) ||
                    (m.original_title && m.original_title.toLowerCase().includes(search))
                );
            }

            html += filtered.map(m => `
                <div class="searchable-select-option ${m.id == selectedId ? 'selected' : ''}"
                     onclick="cleanupMovieSearch.select(${m.id}, '${m.title.replace(/'/g, "\\'")}')">
                    <div class="searchable-select-option-poster">
                        ${m.poster_url ? `<img src="${m.poster_url}" alt="">` : 'üé¨'}
                    </div>
                    <div class="searchable-select-option-info">
                        <div class="searchable-select-option-title">${m.title}</div>
                        <div class="searchable-select-option-meta">
                            ${m.status === 'now_showing' ? 'En cartelera' : m.status === 'coming_soon' ? 'Pr√≥ximamente' : 'Archivada'}
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        };
        cleanupMovieSearch.reset = function() {
            document.getElementById('cleanup-movie').value = '';
            document.getElementById('cleanup-movie-text').textContent = 'Todas las pel√≠culas';
            document.getElementById('cleanup-movie-search').value = '';
            this.close();
        };
        cleanupMovieSearch.originalSelect = cleanupMovieSearch.select;
        cleanupMovieSearch.select = function(id, title) {
            document.getElementById('cleanup-movie').value = id;
            document.getElementById('cleanup-movie-text').textContent = title;
            this.close();
            updateCleanupPreview();
        };

        // Expose functions globally for onclick handlers
        function toggleMovieSearch() { bulkMovieSearch.toggle(); }
        function filterMovieOptions() { bulkMovieSearch.filter(); }
        function toggleShowtimeMovieSearch() { showtimeMovieSearch.toggle(); }
        function filterShowtimeMovieOptions() { showtimeMovieSearch.filter(); }
        function toggleCleanupMovieSearch() { cleanupMovieSearch.toggle(); }
        function filterCleanupMovieOptions() { cleanupMovieSearch.filter(); }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            const bulkSelect = document.getElementById('bulk-movie-select');
            const showtimeSelect = document.getElementById('showtime-movie-select');
            const cleanupSelect = document.getElementById('cleanup-movie-select');

            if (bulkSelect && !bulkSelect.contains(e.target)) {
                bulkMovieSearch.close();
            }
            if (showtimeSelect && !showtimeSelect.contains(e.target)) {
                showtimeMovieSearch.close();
            }
            if (cleanupSelect && !cleanupSelect.contains(e.target)) {
                cleanupMovieSearch.close();
            }
        });

        // ========== BULK SHOWTIME CRUD ==========
        let bulkTimes = [];

        function showBulkModal() {
            // Reset form
            bulkTimes = [];
            document.getElementById('bulk-cinema').innerHTML = '<option value="">Seleccionar cine</option>' +
                cinemas.filter(c => c.status === 'approved').map(c => `<option value="${c.id}">${c.name}</option>`).join('');

            // Reset movie searchable select
            bulkMovieSearch.reset();

            // Set default dates (today + 7 days)
            const today = new Date();
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);

            document.getElementById('bulk-date-from').value = today.toISOString().split('T')[0];
            document.getElementById('bulk-date-to').value = nextWeek.toISOString().split('T')[0];
            document.getElementById('bulk-format').value = '2D';
            document.getElementById('bulk-language').value = 'subtitulada';
            document.getElementById('bulk-screen').value = '1';
            document.getElementById('bulk-price').value = '0';
            document.getElementById('bulk-new-time').value = '';

            // Reset checkboxes (all checked)
            document.querySelectorAll('.days-grid input').forEach(cb => cb.checked = true);

            renderBulkTimes();
            updateBulkPreview();
            openModal('bulk');
        }

        function addBulkTime() {
            const timeInput = document.getElementById('bulk-new-time');
            const time = timeInput.value;
            if (!time) {
                Components.toast('Ingres√° un horario', 'warning');
                return;
            }
            if (bulkTimes.includes(time)) {
                Components.toast('Ese horario ya est√° agregado', 'warning');
                return;
            }
            bulkTimes.push(time);
            bulkTimes.sort();
            timeInput.value = '';
            renderBulkTimes();
            updateBulkPreview();
        }

        function addQuickTime(time) {
            if (bulkTimes.includes(time)) {
                Components.toast('Ese horario ya est√° agregado', 'warning');
                return;
            }
            bulkTimes.push(time);
            bulkTimes.sort();
            renderBulkTimes();
            updateBulkPreview();
        }

        function removeBulkTime(time) {
            bulkTimes = bulkTimes.filter(t => t !== time);
            renderBulkTimes();
            updateBulkPreview();
        }

        function renderBulkTimes() {
            const container = document.getElementById('bulk-times-list');
            if (bulkTimes.length === 0) {
                container.innerHTML = '<span class="text-muted">Ning√∫n horario agregado</span>';
                return;
            }
            container.innerHTML = bulkTimes.map(t => `
                <span class="time-tag">
                    ${t}
                    <button type="button" onclick="removeBulkTime('${t}')">&times;</button>
                </span>
            `).join('');
        }

        function updateBulkPreview() {
            const fromDate = document.getElementById('bulk-date-from').value;
            const toDate = document.getElementById('bulk-date-to').value;

            if (!fromDate || !toDate || bulkTimes.length === 0) {
                document.getElementById('bulk-preview-text').textContent = '0 funciones ser√°n creadas';
                return;
            }

            // Get selected days
            const selectedDays = [];
            document.querySelectorAll('.days-grid input:checked').forEach(cb => {
                selectedDays.push(parseInt(cb.value));
            });

            if (selectedDays.length === 0) {
                document.getElementById('bulk-preview-text').textContent = '0 funciones ser√°n creadas (seleccion√° al menos un d√≠a)';
                return;
            }

            // Count dates in range that match selected days
            let dateCount = 0;
            const start = new Date(fromDate);
            const end = new Date(toDate);

            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                if (selectedDays.includes(d.getDay())) {
                    dateCount++;
                }
            }

            const total = dateCount * bulkTimes.length;
            document.getElementById('bulk-preview-text').textContent = `${total} funciones ser√°n creadas (${dateCount} d√≠as √ó ${bulkTimes.length} horarios)`;
        }

        async function saveBulkShowtimes() {
            const cinemaId = document.getElementById('bulk-cinema').value;
            const movieId = document.getElementById('bulk-movie').value;
            const fromDate = document.getElementById('bulk-date-from').value;
            const toDate = document.getElementById('bulk-date-to').value;
            const format = document.getElementById('bulk-format').value;
            const language = document.getElementById('bulk-language').value;
            const screen = parseInt(document.getElementById('bulk-screen').value) || 1;
            const price = parseFloat(document.getElementById('bulk-price').value) || 0;

            // Validations
            if (!cinemaId) {
                Components.toast('Seleccion√° un cine', 'error');
                return;
            }
            if (!movieId) {
                Components.toast('Seleccion√° una pel√≠cula', 'error');
                return;
            }
            if (!fromDate || !toDate) {
                Components.toast('Seleccion√° las fechas', 'error');
                return;
            }
            if (bulkTimes.length === 0) {
                Components.toast('Agreg√° al menos un horario', 'error');
                return;
            }

            // Get selected days
            const selectedDays = [];
            document.querySelectorAll('.days-grid input:checked').forEach(cb => {
                selectedDays.push(parseInt(cb.value));
            });

            if (selectedDays.length === 0) {
                Components.toast('Seleccion√° al menos un d√≠a de la semana', 'error');
                return;
            }

            // Generate all showtimes
            const showtimesToCreate = [];
            const start = new Date(fromDate);
            const end = new Date(toDate);

            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                if (selectedDays.includes(d.getDay())) {
                    const dateStr = d.toISOString().split('T')[0];
                    for (const time of bulkTimes) {
                        showtimesToCreate.push({
                            cinema_id: parseInt(cinemaId),
                            movie_id: parseInt(movieId),
                            show_date: dateStr,
                            show_time: time,
                            format: format,
                            language: language,
                            screen_number: screen,
                            price: price
                        });
                    }
                }
            }

            if (showtimesToCreate.length === 0) {
                Components.toast('No hay funciones para crear', 'error');
                return;
            }

            try {
                Components.toast(`Creando ${showtimesToCreate.length} funciones...`, 'info');

                const res = await api.createShowtimesBulk(showtimesToCreate);

                if (res.success) {
                    Components.toast(`${res.data.created} funciones creadas exitosamente`, 'success');
                    closeModal('bulk');
                    loadShowtimes();
                } else {
                    Components.toast(res.message || 'Error creando funciones', 'error');
                }
            } catch (e) {
                Components.toast(e.message || 'Error creando funciones', 'error');
            }
        }

        // ========== CLEANUP CRUD ==========
        let cleanupShowtimes = [];

        function showCleanupModal() {
            // Reset form
            cleanupMovieSearch.reset();
            document.getElementById('cleanup-cinema').innerHTML = '<option value="">Todos los cines</option>' +
                cinemas.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            document.getElementById('cleanup-date-from').value = '';
            document.getElementById('cleanup-date-to').value = '';
            document.getElementById('cleanup-past-only').checked = false;

            cleanupShowtimes = [];
            updateCleanupPreview();
            openModal('cleanup');
        }

        async function updateCleanupPreview() {
            const movieId = document.getElementById('cleanup-movie').value;
            const cinemaId = document.getElementById('cleanup-cinema').value;
            const dateFrom = document.getElementById('cleanup-date-from').value;
            const dateTo = document.getElementById('cleanup-date-to').value;
            const pastOnly = document.getElementById('cleanup-past-only').checked;

            // Build params
            const params = {};
            if (movieId) params.movie_id = movieId;
            if (cinemaId) params.cinema_id = cinemaId;

            try {
                const res = await api.getAdminShowtimes(params);
                if (!res.success) {
                    cleanupShowtimes = [];
                    renderCleanupPreview();
                    return;
                }

                let filtered = res.data || [];
                const today = new Date().toISOString().split('T')[0];

                // Filter by date range
                if (dateFrom) {
                    filtered = filtered.filter(s => s.show_date >= dateFrom);
                }
                if (dateTo) {
                    filtered = filtered.filter(s => s.show_date <= dateTo);
                }
                if (pastOnly) {
                    filtered = filtered.filter(s => s.show_date < today);
                }

                cleanupShowtimes = filtered;
                renderCleanupPreview();

            } catch (e) {
                console.error('Error loading showtimes for cleanup:', e);
                cleanupShowtimes = [];
                renderCleanupPreview();
            }
        }

        function renderCleanupPreview() {
            const countEl = document.getElementById('cleanup-count');
            const listEl = document.getElementById('cleanup-list');
            const btnEl = document.getElementById('cleanup-btn');

            countEl.textContent = cleanupShowtimes.length;
            btnEl.disabled = cleanupShowtimes.length === 0;

            if (cleanupShowtimes.length === 0) {
                listEl.innerHTML = '<div class="text-center text-muted p-2">No hay funciones que coincidan con los filtros</div>';
                return;
            }

            // Group by movie for cleaner display
            const byMovie = {};
            cleanupShowtimes.forEach(s => {
                if (!byMovie[s.movie_title]) {
                    byMovie[s.movie_title] = [];
                }
                byMovie[s.movie_title].push(s);
            });

            let html = '';
            for (const [movie, items] of Object.entries(byMovie)) {
                html += `<div class="cleanup-preview-item">
                    <span><strong>${movie}</strong></span>
                    <span>${items.length} funci√≥n(es)</span>
                </div>`;
                // Show first 3 dates
                const dates = [...new Set(items.map(i => i.show_date))].slice(0, 3);
                html += `<div style="padding-left: 1rem; font-size: 0.75rem; color: #888;">
                    ${dates.join(', ')}${items.length > 3 ? '...' : ''}
                </div>`;
            }

            listEl.innerHTML = html;
        }

        async function executeCleanup() {
            if (cleanupShowtimes.length === 0) return;

            const confirm1 = confirm(`¬øEst√°s seguro de eliminar ${cleanupShowtimes.length} funciones?`);
            if (!confirm1) return;

            const confirm2 = confirm(`Esta acci√≥n no se puede deshacer. ¬øConfirmar eliminaci√≥n?`);
            if (!confirm2) return;

            try {
                Components.toast(`Eliminando ${cleanupShowtimes.length} funciones...`, 'info');

                const ids = cleanupShowtimes.map(st => st.id);
                const res = await api.deleteShowtimesBulk(ids);

                if (res.success) {
                    Components.toast(`${res.data.deleted} funciones eliminadas exitosamente`, 'success');
                } else {
                    Components.toast(res.message || 'Error eliminando funciones', 'error');
                }

                closeModal('cleanup');
                loadShowtimes();

            } catch (e) {
                Components.toast(e.message || 'Error eliminando funciones', 'error');
            }
        }

        // Init
        document.getElementById('filter-showtime-date').value = new Date().toISOString().split('T')[0];
        loadData();
    </script>
</body>
</html>
