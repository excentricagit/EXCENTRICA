<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventos - Editor Excentrica</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/editor/editor.css">
    <link rel="stylesheet" href="/editor/eventos.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <a href="/"><span>âš¡</span> Excentrica</a>
                <span class="admin-badge">EDITOR</span>
            </div>
            <nav class="admin-nav">
                <a href="/editor/" class="admin-nav-item">
                    <span class="icon">ğŸ“Š</span> Dashboard
                </a>
                <a href="/editor/noticias.html" class="admin-nav-item">
                    <span class="icon">ğŸ“°</span> Noticias
                </a>
                <a href="/editor/productos.html" class="admin-nav-item">
                    <span class="icon">ğŸ›’</span> Productos
                </a>
                <a href="/editor/eventos.html" class="admin-nav-item active">
                    <span class="icon">ğŸ“…</span> Eventos
                </a>
                <a href="/editor/categorias.html" class="admin-nav-item">
                    <span class="icon">ğŸ“</span> Categorias
                </a>
                <a href="/editor/zonas.html" class="admin-nav-item">
                    <span class="icon">ğŸ“</span> Zonas
                </a>
                <a href="/editor/cine.html" class="admin-nav-item">
                    <span class="icon">ğŸ¬</span> Cine
                </a>
                <a href="/editor/gastronomia.html" class="admin-nav-item">
                    <span class="icon">ğŸ½ï¸</span> Gastronomia
                </a>
                <a href="/editor/alojamiento.html" class="admin-nav-item">
                    <span class="icon">ğŸ¨</span> Alojamiento
                </a>
                <a href="/editor/transporte.html" class="admin-nav-item">
                    <span class="icon">ğŸšŒ</span> Transporte
                </a>
                <a href="/editor/servicios.html" class="admin-nav-item">
                    <span class="icon">ğŸ”§</span> Servicios
                </a>
                <a href="/editor/puntos-interes.html" class="admin-nav-item">
                    <span class="icon">ğŸ“</span> Turismo
                </a>
                <div class="admin-nav-divider"></div>
                <a href="/" class="admin-nav-item">
                    <span class="icon">ğŸ </span> Volver al sitio
                </a>
                <a href="#" onclick="auth.logout(); return false;" class="admin-nav-item">
                    <span class="icon">ğŸšª</span> Cerrar sesion
                </a>
            </nav>
        </aside>

        <!-- Main content -->
        <main class="admin-main">
            <header class="admin-header">
                <h1>ğŸ“… Gestion de Eventos</h1>
                <div class="admin-user">
                    <span id="user-name">Editor</span>
                    <div class="btn-group">
                        <button class="btn btn-primary btn-sm" onclick="showCreateModal()">
                            â• Evento
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="showSorteoModal()" style="border-color: #a855f7; color: #a855f7;">
                            ğŸ² Sorteo
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="showRecurrenteModal()" style="border-color: #3b82f6; color: #3b82f6;" title="Selecciona un evento de la tabla y usa el boton ğŸ”„ para duplicarlo">
                            ğŸ”„ Duplicar Semanal
                        </button>
                    </div>
                </div>
            </header>

            <div class="admin-content">
                <!-- Tabs -->
                <div class="event-tabs mb-4">
                    <button class="event-tab active" data-tab="eventos" onclick="switchTab('eventos')">
                        ğŸ“… Eventos
                    </button>
                    <button class="event-tab" data-tab="sorteos" onclick="switchTab('sorteos')">
                        ğŸ² Sorteos
                    </button>
                </div>

                <!-- Tab: Eventos -->
                <div class="tab-content active" id="tab-eventos">
                <!-- Stats -->
                <div class="stats-grid mb-4">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“…</div>
                        <div class="stat-info">
                            <span class="stat-value" id="total-events">0</span>
                            <span class="stat-label">Total eventos</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â³</div>
                        <div class="stat-info">
                            <span class="stat-value" id="pending-events">0</span>
                            <span class="stat-label">Pendientes</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âœ…</div>
                        <div class="stat-info">
                            <span class="stat-value" id="approved-events">0</span>
                            <span class="stat-label">Aprobados</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ”œ</div>
                        <div class="stat-info">
                            <span class="stat-value" id="upcoming-events">0</span>
                            <span class="stat-label">Proximos</span>
                        </div>
                    </div>
                </div>

                <!-- Compact filters -->
                <div class="d-flex gap-3 mb-4 flex-wrap">
                    <input type="text" id="search" class="form-control" placeholder="Buscar..." style="max-width: 200px;">
                    <select id="filter-status" class="form-control" style="max-width: 150px;">
                        <option value="">Todos los estados</option>
                        <option value="pending">Pendiente</option>
                        <option value="approved">Aprobado</option>
                        <option value="rejected">Rechazado</option>
                    </select>
                    <select id="filter-date" class="form-control" style="max-width: 150px;">
                        <option value="">Todas las fechas</option>
                        <option value="upcoming">Proximos</option>
                        <option value="past">Pasados</option>
                    </select>
                    <button class="btn btn-outline btn-sm" onclick="resetFilters()">
                        Limpiar
                    </button>
                </div>

                <!-- Events Table -->
                <div class="card">
                    <div class="card-body">
                        <div id="events-table-container">
                            <div class="text-center p-4">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>
                </div><!-- End tab-eventos -->

                <!-- Tab: Sorteos -->
                <div class="tab-content" id="tab-sorteos" style="display: none;">
                    <!-- Sorteos Stats -->
                    <div class="stats-grid mb-4">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ²</div>
                            <div class="stat-info">
                                <span class="stat-value" id="total-sorteos">0</span>
                                <span class="stat-label">Sorteos activos</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ‘¥</div>
                            <div class="stat-info">
                                <span class="stat-value" id="total-participants">0</span>
                                <span class="stat-label">Participantes</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ†</div>
                            <div class="stat-info">
                                <span class="stat-value" id="total-finalizados">0</span>
                                <span class="stat-label">Finalizados</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sorteos filters -->
                    <div class="d-flex gap-3 mb-4 flex-wrap">
                        <select id="filter-sorteo-status" class="form-control" style="max-width: 150px;" onchange="loadSorteos()">
                            <option value="">Todos</option>
                            <option value="activo">Activos</option>
                            <option value="finalizado">Finalizados</option>
                            <option value="cancelado">Cancelados</option>
                        </select>
                    </div>

                    <!-- Sorteos List -->
                    <div id="sorteos-container">
                        <div class="text-center p-4"><div class="spinner"></div></div>
                    </div>
                </div><!-- End tab-sorteos -->
            </div>
        </main>
    </div>

    <!-- Modal para crear/editar evento -->
    <div class="modal-backdrop" id="event-modal-backdrop" onclick="closeModal()"></div>
    <div class="modal" id="event-modal">
        <div class="modal-header">
            <h3 class="modal-title" id="modal-title">Nuevo Evento</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeModal()">Cancelar</button>
                <button type="submit" form="event-form" class="btn btn-primary btn-sm">Guardar Evento</button>
            </div>
        </div>
        <div class="modal-body">
            <form id="event-form" onsubmit="saveEvent(event)">
                <input type="hidden" id="event-id">
                <input type="hidden" id="event-imagen">

                <div class="modal-grid-3-compact">
                    <!-- Column 1: Informacion Principal -->
                    <div class="form-column">
                        <div class="form-group">
                            <label for="event-titulo">Titulo *</label>
                            <input type="text" id="event-titulo" class="form-control" placeholder="Nombre del evento" required>
                        </div>

                        <div class="form-group">
                            <label for="event-descripcion">Descripcion *</label>
                            <textarea id="event-descripcion" class="form-control" rows="3" placeholder="Describe el evento..." required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="event-fecha">ğŸ“… Fecha del Evento *</label>
                            <input type="datetime-local" id="event-fecha" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="event-lugar">ğŸ“ Lugar *</label>
                            <input type="text" id="event-lugar" class="form-control" placeholder="Ej: Teatro 25 de Mayo" required>
                        </div>

                        <div class="form-group">
                            <label for="event-direccion">ğŸ—ºï¸ Direccion</label>
                            <input type="text" id="event-direccion" class="form-control" placeholder="Direccion completa">
                        </div>
                    </div>

                    <!-- Column 2: Detalles y Contacto -->
                    <div class="form-column">
                        <div class="form-group">
                            <label for="event-precio">ğŸ’° Precio de Entrada</label>
                            <input type="number" id="event-precio" class="form-control" step="0.01" min="0" placeholder="0 para eventos gratuitos">
                        </div>

                        <div class="form-group">
                            <label for="event-categoria">ğŸ“ Categoria</label>
                            <select id="event-categoria" class="form-control">
                                <option value="">Sin categoria</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="event-zona">ğŸŒ Zona</label>
                            <select id="event-zona" class="form-control">
                                <option value="">Sin zona especifica</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="event-telefono">ğŸ“ Telefono</label>
                            <input type="tel" id="event-telefono" class="form-control" placeholder="+54 9 385 123 4567">
                        </div>

                        <div class="form-group">
                            <label for="event-whatsapp">ğŸ’¬ WhatsApp</label>
                            <input type="tel" id="event-whatsapp" class="form-control" placeholder="+54 9 385 123 4567">
                        </div>

                        <div class="form-group">
                            <label for="event-web">ğŸŒ Sitio Web</label>
                            <input type="url" id="event-web" class="form-control" placeholder="https://ejemplo.com">
                        </div>

                        <div class="form-group">
                            <label for="event-estado">âš™ï¸ Estado</label>
                            <select id="event-estado" class="form-control">
                                <option value="pending">Pendiente</option>
                                <option value="approved">Aprobado</option>
                                <option value="rejected">Rechazado</option>
                            </select>
                        </div>
                    </div>

                    <!-- Column 3: Imagen y Hero -->
                    <div class="form-column">
                        <div class="form-group">
                            <label for="event-imagen-file">ğŸ“¸ Imagen del Evento *</label>
                            <small class="text-muted" style="display:block; margin-bottom:0.5rem;">Dimensiones recomendadas: 550 x 367 px</small>
                            <input type="file" id="event-imagen-file" class="form-control-file" accept="image/*" onchange="uploadEventImage(event)">
                            <div id="event-image-preview" class="image-preview-compact"></div>
                        </div>

                        <div class="form-group">
                            <label>â­ Posicion en Hero</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="event-is-featured">
                                    <span>Destacado</span>
                                    <small>(columna derecha)</small>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="event-is-special">
                                    <span>Evento Especial</span>
                                    <small>(card inferior)</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Sorteo -->
    <div class="modal-backdrop" id="sorteo-modal-backdrop" onclick="closeSorteoModal()"></div>
    <div class="modal" id="sorteo-modal">
        <div class="modal-header">
            <h3 class="modal-title">ğŸ² Nuevo Sorteo</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeSorteoModal()">Cancelar</button>
                <button type="submit" form="sorteo-form" class="btn btn-primary btn-sm">Crear Sorteo</button>
            </div>
        </div>
        <div class="modal-body">
            <form id="sorteo-form" onsubmit="saveSorteo(event)">
                <input type="hidden" id="sorteo-id">
                <div class="modal-grid-2">
                    <div class="form-column">
                        <div class="form-group">
                            <label>Titulo del Sorteo *</label>
                            <input type="text" id="sorteo-titulo" class="form-control" placeholder="Ej: Sorteo iPhone 15" required>
                        </div>
                        <div class="form-group">
                            <label>ğŸ Descripcion del Premio *</label>
                            <textarea id="sorteo-premio" class="form-control" rows="2" placeholder="Describe el premio..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label>ğŸ’° Valor del Premio ($)</label>
                            <input type="number" id="sorteo-valor" class="form-control" min="0" step="0.01" placeholder="Opcional">
                        </div>
                        <div class="form-group">
                            <label>ğŸ“ Lugar (donde se entrega)</label>
                            <input type="text" id="sorteo-lugar" class="form-control" placeholder="Lugar de entrega">
                        </div>
                        <div class="form-group">
                            <label>ğŸ“ WhatsApp de contacto</label>
                            <input type="tel" id="sorteo-whatsapp" class="form-control" placeholder="+54 9 385...">
                        </div>
                    </div>
                    <div class="form-column">
                        <div class="form-group">
                            <label>ğŸ“… Fecha del Sorteo *</label>
                            <input type="date" id="sorteo-fecha" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>â° Hora</label>
                            <input type="time" id="sorteo-hora" class="form-control" value="20:00">
                        </div>
                        <div class="form-group">
                            <label>ğŸ† Cantidad de Ganadores</label>
                            <input type="number" id="sorteo-ganadores" class="form-control" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label>ğŸ‘¥ Max. Participantes</label>
                            <input type="number" id="sorteo-max" class="form-control" min="0" placeholder="Ilimitado">
                        </div>
                        <div class="form-group">
                            <label>ğŸ“† Fecha limite inscripcion</label>
                            <input type="date" id="sorteo-deadline" class="form-control">
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Duplicar Evento Semanalmente -->
    <div class="modal-backdrop" id="duplicar-modal-backdrop" onclick="closeDuplicarModal()"></div>
    <div class="modal" id="duplicar-modal" style="max-width: 450px;">
        <div class="modal-header">
            <h3 class="modal-title">ğŸ”„ Duplicar Semanalmente</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeDuplicarModal()">Cancelar</button>
                <button type="submit" form="duplicar-form" class="btn btn-primary btn-sm">Crear Copias</button>
            </div>
        </div>
        <div class="modal-body">
            <form id="duplicar-form" onsubmit="duplicarEvento(event)">
                <input type="hidden" id="duplicar-evento-id">
                <p class="mb-3" id="duplicar-evento-info" style="color: var(--text-muted);"></p>
                <div class="form-group">
                    <label>ğŸ”¢ Cantidad de semanas a duplicar</label>
                    <input type="number" id="duplicar-semanas" class="form-control" min="1" max="52" value="4" onchange="previewDuplicar()">
                    <small class="text-muted">Se crearan copias del evento en las proximas semanas</small>
                </div>
                <div class="form-group">
                    <label>Vista previa de fechas:</label>
                    <div id="duplicar-preview" style="max-height: 150px; overflow-y: auto; background: var(--bg-dark); padding: 0.75rem; border-radius: 8px; font-size: 0.85rem;">
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Participantes Sorteo -->
    <div class="modal-backdrop" id="participants-modal-backdrop" onclick="closeParticipantsModal()"></div>
    <div class="modal" id="participants-modal">
        <div class="modal-header">
            <h3 class="modal-title">ğŸ‘¥ Participantes del Sorteo</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-outline btn-sm" onclick="closeParticipantsModal()">Cerrar</button>
                <button type="button" class="btn btn-primary btn-sm" id="btn-sortear" onclick="selectWinners()">ğŸ† Sortear</button>
            </div>
        </div>
        <div class="modal-body">
            <div id="participants-list">
                <div class="text-center p-4"><div class="spinner"></div></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/js/config.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/components.js"></script>
    <script src="/editor/eventos.js"></script>
</body>
</html>
